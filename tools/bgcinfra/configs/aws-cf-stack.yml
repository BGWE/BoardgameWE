AWSTemplateFormatVersion: 2010-09-09
Metadata:
  'AWS::CloudFormation::Designer':
    6789aa09-9d71-4c24-95f6-b32b6484a161:
      size:
        width: 580
        height: 220
      position:
        x: 690
        'y': 160
      z: 0
      embeds:
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - 45649b40-0c00-4005-9eb4-08edb888cba8
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
    092f8d06-c428-4b5a-a2bf-c1c3d7e3144e:
      size:
        width: 140
        height: 140
      position:
        x: 930
        'y': 220
      z: 1
      parent: 6789aa09-9d71-4c24-95f6-b32b6484a161
      embeds:
        - 75b0f6b2-47e1-4973-8068-91a295189fd0
      iscontainedinside:
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
    75b0f6b2-47e1-4973-8068-91a295189fd0:
      size:
        width: 60
        height: 60
      position:
        x: 980
        'y': 270
      z: 2
      parent: 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
      embeds: []
      iscontainedinside:
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
        - 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
      dependson:
        - 6f3b571c-8903-47ac-8795-d80004afca7d
    45649b40-0c00-4005-9eb4-08edb888cba8:
      size:
        width: 60
        height: 60
      position:
        x: 1120
        'y': 270
      z: 1
      parent: 6789aa09-9d71-4c24-95f6-b32b6484a161
      embeds: []
      iscontainedinside:
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
    d6590691-111e-4aca-9b27-af5cce67a6e1:
      size:
        width: 60
        height: 60
      position:
        x: 580
        'y': 230
      z: 0
      embeds: []
    d9aa486d-3ba7-4483-9be9-19b37426fc19:
      size:
        width: 170
        height: 110
      position:
        x: 730
        'y': 240
      z: 1
      parent: 6789aa09-9d71-4c24-95f6-b32b6484a161
      embeds:
        - 6f3b571c-8903-47ac-8795-d80004afca7d
      iscontainedinside:
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
        - 6789aa09-9d71-4c24-95f6-b32b6484a161
    b6d108bb-0424-40cc-bef3-6b75293feae5:
      source:
        id: 6789aa09-9d71-4c24-95f6-b32b6484a161
      target:
        id: d6590691-111e-4aca-9b27-af5cce67a6e1
      z: 0
    6f3b571c-8903-47ac-8795-d80004afca7d:
      size:
        width: 60
        height: 60
      position:
        x: 760
        'y': 270
      z: 2
      parent: d9aa486d-3ba7-4483-9be9-19b37426fc19
      embeds: []
      isassociatedwith:
        - d6590691-111e-4aca-9b27-af5cce67a6e1
      iscontainedinside:
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
        - d9aa486d-3ba7-4483-9be9-19b37426fc19
      dependson:
        - b6d108bb-0424-40cc-bef3-6b75293feae5
    29fa4379-3c23-49b1-b896-11fde3d208f0:
      source:
        id: d9aa486d-3ba7-4483-9be9-19b37426fc19
      target:
        id: 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
      z: 1
    cf9055d9-130f-4def-acfa-82a5f02dc04f:
      size:
        width: 60
        height: 60
      position:
        x: 1320
        'y': 260
      z: 0
      embeds: []
Resources:
  VPC:
    Type: 'AWS::EC2::VPC'
    Properties:
      EnableDnsSupport: 'true'
      EnableDnsHostnames: 'true'
      CidrBlock: 10.0.0.0/16
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 6789aa09-9d71-4c24-95f6-b32b6484a161
  PublicSubnet:
    Type: 'AWS::EC2::Subnet'
    Properties:
      VpcId: !Ref VPC
      CidrBlock: 10.0.0.0/24
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 092f8d06-c428-4b5a-a2bf-c1c3d7e3144e
  WebServerInstance:
    Type: 'AWS::EC2::Instance'
    Properties:
      InstanceType: !Ref InstanceType
      ImageId: !FindInMap 
        - AWSRegionArch2AMI
        - !Ref 'AWS::Region'
        - !FindInMap 
          - AWSInstanceType2Arch
          - !Ref InstanceType
          - Arch
      KeyName: !Ref KeyName
      NetworkInterfaces:
        - GroupSet:
            - !Ref WebServerSecurityGroup
          AssociatePublicIpAddress: 'true'
          DeviceIndex: '0'
          DeleteOnTermination: 'true'
          SubnetId: !Ref PublicSubnet
      IamInstanceProfile: !Ref ServerInstanceProfile
      UserData: !Base64 
        'Fn::Join':
          - ''
          - - |
              #!/bin/bash -xe
            - |
              yum install -y aws-cfn-bootstrap
            - |
              # Install the files and packages from the metadata
            - '/opt/aws/bin/cfn-init -v '
            - '         --stack '
            - !Ref 'AWS::StackName'
            - '         --resource WebServerInstance '
            - '         --region '
            - !Ref 'AWS::Region'
            - |+

            - |
            
            - |
              sudo amazon-linux-extras install ansible2
            - |
              sudo yum -y update
            - |
              sudo easy_install pip
            - |
              sudo pip install virtualenv 
            - |
              sudo amazon-linux-extras install -y nginx1.12
            - |
              sudo nginx
            - |
              cd /tmp
            - |
              sudo curl -O http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
            - |
              sudo yum install -y epel-release-latest-7.noarch.rpm
            - |
              sudo yum -y update
            - |
              sudo yum -y install yum-utils
            - |
              yum-config-manager --enable rhui-REGION-rhel-server-extras rhui-REGION-rhel-server-optional
            - |
              sudo yum install -y certbot python2-certbot-nginx npm git gcc-c++
            - |
              sudo npm install -g pm2 n
            - |
              sudo n 10.16.3
            - |
              sudo n use 10.16.3
            - |
              # Signal the status from cfn-init
            - '/opt/aws/bin/cfn-signal -e $? '
            - '         --stack '
            - !Ref 'AWS::StackName'
            - '         --resource WebServerInstance '
            - '         --region '
            - !Ref 'AWS::Region'
            - ''
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 75b0f6b2-47e1-4973-8068-91a295189fd0
      'AWS::CloudFormation::Init': 
        config:
          files:
            /tmp/https.conf:
              content: !Sub |
                    # HTTPS server
                    upstream nodejs {
                        server 127.0.0.1:3000;
                    }

                    upstream appmetrics {
                        server 127.0.0.1:3001;
                    }

                    server {
                        listen       443 default ssl;
                        server_name  localhost;
                        error_page  497 https://$host$request_uri;

                        ssl_certificate      /etc/letsencrypt/live/bgccert/fullchain.pem;
                        ssl_certificate_key  /etc/letsencrypt/live/bgccert/privkey.pem;
                        ssl_session_timeout  5m;
                        ssl_protocols  TLSv1.1 TLSv1.2;
                        ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
                        ssl_prefer_server_ciphers   on;
                        if ($ssl_protocol = "") {
                            rewrite ^ https://$host$request_uri? permanent;
                        }
                        location ~ ^/(lib/|img/) {
                            root /var/app/current/public;
                            access_log off;
                        }
                        location / {
                            proxy_pass  http://nodejs;
                            proxy_redirect off;
                            proxy_set_header   Connection "";
                            proxy_http_version 1.1;
                            proxy_set_header        Host            $host;
                            proxy_set_header        X-Real-IP       $remote_addr;
                            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
                            proxy_set_header        Upgrade         $http_upgrade;
                            proxy_set_header        Connection      "upgrade";
                        }

                        location /status {
                            proxy_pass  http://appmetrics;
                            proxy_redirect off;
                            proxy_set_header   Connection "";
                            proxy_http_version 1.1;
                            proxy_set_header        Host            $host;
                            proxy_set_header        X-Real-IP       $remote_addr;
                            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
                            proxy_set_header        Upgrade         $http_upgrade;
                            proxy_set_header        Connection      "upgrade";
                        }
                    }
    DependsOn:
      - PublicRoute
  WebServerSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      VpcId: !Ref VPC
      GroupDescription: 'Allow access from HTTP, HTTPS and SSH traffic'
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: '80'
          ToPort: '80'
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: '443'
          ToPort: '443'
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: '22'
          ToPort: '22'
          CidrIp: !Ref SSHLocation
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 45649b40-0c00-4005-9eb4-08edb888cba8
  InternetGateway:
    Type: 'AWS::EC2::InternetGateway'
    Properties: {}
    Metadata:
      'AWS::CloudFormation::Designer':
        id: d6590691-111e-4aca-9b27-af5cce67a6e1
  PublicRouteTable:
    Type: 'AWS::EC2::RouteTable'
    Properties:
      VpcId: !Ref VPC
    Metadata:
      'AWS::CloudFormation::Designer':
        id: d9aa486d-3ba7-4483-9be9-19b37426fc19
  EC2VPCG22535:
    Type: 'AWS::EC2::VPCGatewayAttachment'
    Properties:
      VpcId: !Ref VPC
      InternetGatewayId: !Ref InternetGateway
    Metadata:
      'AWS::CloudFormation::Designer':
        id: b6d108bb-0424-40cc-bef3-6b75293feae5
  PublicRoute:
    Type: 'AWS::EC2::Route'
    Properties:
      RouteTableId: !Ref PublicRouteTable
      GatewayId: !Ref InternetGateway
      DestinationCidrBlock: 0.0.0.0/0
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 6f3b571c-8903-47ac-8795-d80004afca7d
    DependsOn:
      - EC2VPCG22535
  SubnetRouteTableAssociation:
    Type: 'AWS::EC2::SubnetRouteTableAssociation'
    Properties:
      RouteTableId: !Ref PublicRouteTable
      SubnetId: !Ref PublicSubnet
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 29fa4379-3c23-49b1-b896-11fde3d208f0
  Route53RecordSet:
    Type: 'AWS::Route53::RecordSet'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: cf9055d9-130f-4def-acfa-82a5f02dc04f
    DependsOn:
      - WebServerInstance
    Properties:
      HostedZoneName: !Ref HostedZoneName
      Comment: DNS name for my instance.
      Name: !Join 
        - ''
        - - !Ref Subdomain
          - .
          - !Ref HostedZoneName
      Type: A
      TTL: '900'
      ResourceRecords:
        - !GetAtt WebServerInstance.PublicIp
  ServerInstanceProfile:
    Type: AWS::IAM::InstanceProfile
    Properties:
      Path: /
      Roles:
        - !Ref EC2ToSystemsManagerAdminRole
  EC2ToSystemsManagerAdminRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Principal:
              Service: ec2.amazonaws.com
            Action: sts:AssumeRole
      Path: /
  SystemsManagerAdminPolicy:
    Type: AWS::IAM::Policy
    DependsOn:
      - WebServerInstance
    Properties:
      PolicyName: SystemsManagerAdminPolicy
      PolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Action: 'ssm:*'
            Resource: '*'
      Roles:
        - !Ref EC2ToSystemsManagerAdminRole
Parameters:
  InstanceType:
    Description: WebServer EC2 instance type
    Type: String
    Default: t2.micro
    AllowedValues:
      - t1.micro
      - t2.nano
      - t2.micro
      - t2.small
    ConstraintDescription: must be a valid EC2 instance type.
  KeyName:
    Description: Name of an EC2 KeyPair to enable SSH access to the instance.
    Type: 'AWS::EC2::KeyPair::KeyName'
    ConstraintDescription: must be the name of an existing EC2 KeyPair.
  SSHLocation:
    Description: ' The IP address range that can be used to access the web server using SSH.'
    Type: String
    MinLength: '9'
    MaxLength: '18'
    Default: 0.0.0.0/0
    AllowedPattern: '(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})/(\d{1,2})'
    ConstraintDescription: must be a valid IP CIDR range of the form x.x.x.x/x.
  HostedZoneName:
    Description: >-
      The route53 HostedZoneName. For example, "mydomain.com."  Don't forget the
      period at the end.
    Type: String
    Default: boardgamecomponion.com.
  Subdomain:
    Description: >-
      The subdomain of the dns entry. For example, hello -> hello.mydomain.com,
      hello is the subdomain.
    Type: String
    Default: api-v3
Mappings:
  AWSInstanceType2Arch:
    t1.micro:
      Arch: HVM64
    t2.nano:
      Arch: HVM64
    t2.micro:
      Arch: HVM64
    t2.small:
      Arch: HVM64
    t2.medium:
      Arch: HVM64
    t2.large:
      Arch: HVM64
    m1.small:
      Arch: HVM64
    m1.medium:
      Arch: HVM64
    m1.large:
      Arch: HVM64
    m1.xlarge:
      Arch: HVM64
    m2.xlarge:
      Arch: HVM64
    m2.2xlarge:
      Arch: HVM64
    m2.4xlarge:
      Arch: HVM64
    m3.medium:
      Arch: HVM64
    m3.large:
      Arch: HVM64
    m3.xlarge:
      Arch: HVM64
    m3.2xlarge:
      Arch: HVM64
    m4.large:
      Arch: HVM64
    m4.xlarge:
      Arch: HVM64
    m4.2xlarge:
      Arch: HVM64
    m4.4xlarge:
      Arch: HVM64
    m4.10xlarge:
      Arch: HVM64
    c1.medium:
      Arch: HVM64
    c1.xlarge:
      Arch: HVM64
    c3.large:
      Arch: HVM64
    c3.xlarge:
      Arch: HVM64
    c3.2xlarge:
      Arch: HVM64
    c3.4xlarge:
      Arch: HVM64
    c3.8xlarge:
      Arch: HVM64
    c4.large:
      Arch: HVM64
    c4.xlarge:
      Arch: HVM64
    c4.2xlarge:
      Arch: HVM64
    c4.4xlarge:
      Arch: HVM64
    c4.8xlarge:
      Arch: HVM64
    g2.2xlarge:
      Arch: HVMG2
    g2.8xlarge:
      Arch: HVMG2
    r3.large:
      Arch: HVM64
    r3.xlarge:
      Arch: HVM64
    r3.2xlarge:
      Arch: HVM64
    r3.4xlarge:
      Arch: HVM64
    r3.8xlarge:
      Arch: HVM64
    i2.xlarge:
      Arch: HVM64
    i2.2xlarge:
      Arch: HVM64
    i2.4xlarge:
      Arch: HVM64
    i2.8xlarge:
      Arch: HVM64
    d2.xlarge:
      Arch: HVM64
    d2.2xlarge:
      Arch: HVM64
    d2.4xlarge:
      Arch: HVM64
    d2.8xlarge:
      Arch: HVM64
    hi1.4xlarge:
      Arch: HVM64
    hs1.8xlarge:
      Arch: HVM64
    cr1.8xlarge:
      Arch: HVM64
    cc2.8xlarge:
      Arch: HVM64
  AWSRegionArch2AMI:
    eu-west-1:
      HVM64: ami-0bbc25e23a7640b9b
Outputs:
  URL:
    Value: !Join 
      - ''
      - - 'http://'
        - !GetAtt 
          - WebServerInstance
          - PublicIp
    Description: Newly created application URL
